/*
 * Copyright (c) Microsoft Corporation. All rights reserved.
 *
 *
 * This file is automatically generated
 * Please DO NOT modify
*/

package com.microsoft.tscodegen.demo.minieditor.generated

import com.google.gson.Gson
import android.webkit.WebView
{{#associatedTypes.length}}
import java.lang.reflect.Type
import com.google.gson.JsonDeserializationContext
import com.google.gson.JsonDeserializer
import com.google.gson.JsonElement
import com.google.gson.JsonPrimitive
import com.google.gson.JsonSerializationContext
import com.google.gson.JsonSerializer
import com.google.gson.annotations.SerializedName
{{/associatedTypes.length}}

interface {{moduleName}}Interface {
    {{#methods}}
    fun {{methodName}}({{{parametersDeclaration}}}{{#returnType}}{{#parametersDeclaration.length}}, {{/parametersDeclaration.length}}callback: ({{{returnType}}}) -> Unit{{/returnType}})
    {{/methods}}
}

open class {{moduleName}}(private val webView: WebView, private val gson: Gson) : {{moduleName}}Interface {
    {{#methods}}

    {{#parameters.length}}
    data class Args_{{methodName}} (
        {{#parameters}}
        val {{name}}: {{type}},
        {{/parameters}}
    )
    {{/parameters.length}}
    override fun {{methodName}}({{{parametersDeclaration}}}{{#returnType}}{{#parametersDeclaration.length}}, {{/parametersDeclaration.length}}callback: ({{{returnType}}}) -> Unit{{/returnType}}) {
        {{#parameters.length}}
        val args = Args_{{methodName}}(
            {{#parameters}}
            {{name}}{{^last}},{{/last}}
            {{/parameters}}
        )
        val jsonString = gson.toJson(args, Args_{{methodName}}::class.java)
        {{/parameters.length}}
        val javascriptString = "{{customTags.invokePath}}.{{methodName}}({{#parameters.length}}$jsonString{{/parameters.length}})"
        println("[ts-codegen] evaluating JavaScript: $javascriptString")
        webView.evaluateJavascript(javascriptString){ evaluationResult -> 
            {{#returnType}} 
            val result = gson.fromJson(evaluationResult, {{{returnType}}}::class.java)
            callback(result)
            {{/returnType}}
            {{^returnType}}
            println("[ts-codegen] JavaScript result: $evaluationResult")
            {{/returnType}}
        }
    }
    {{/methods}}
}
{{#associatedTypes}}

{{> kotlin-named-type}}
{{/associatedTypes}}
